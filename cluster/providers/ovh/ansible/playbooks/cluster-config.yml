---
- name: Verify K3D cluster
  hosts: k3d_hosts[0]
  become: no
  tasks:
    - name: Get cluster nodes
      command: kubectl get nodes -o wide
      register: nodes_output
      changed_when: false

    - name: Display nodes
      debug:
        var: nodes_output.stdout_lines

    - name: Verify all nodes are Ready
      shell: kubectl get nodes --no-headers | grep -c "Ready"
      register: ready_count
      changed_when: false

    - name: Display ready node count
      debug:
        msg: "{{ ready_count.stdout }} nodes are Ready"
